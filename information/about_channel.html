<div class="ibox nopadding" style="height: 100%;">
  <div class="ibox-title">
    <h5 class="title"></h5>
    <div class="ibox-tools">
      <a class="aside-close-link">
      <i class="fa fa-times"></i>
      </a>
    </div>
  </div>
</div>
<div class="ibox-content information-list">
  <div class="content_area">
    <script id="aboutChannel-template" type="text/template">
      <div>
        <h4><i class="fa fa-info fa-lg text-primary"></i> Purpose</h4>
         <p id="purpose">
           {{pinupMessage}}
         </p>
         <a class='link-edit-purpose' href='#'>Set a channel purpose.</a>
      </div>
      <div id="purpose-edit-area" style="display: none">
        <div>
        <textarea name="purpose" style="width: 100%"></textarea>
        </div>
        <button type="button" class="done btn btn-warning btn-sm"><i class="fa fa-sign-in"></i>DONE</button>
        <button type="button" class="cancle btn btn-info btn-sm"><i class="fa fa-sign-out"></i>CANCLE</button>
      </div>
      <div class="hr-line-dashed"></div>
      <div>
         <h4><i class="fa fa-users fa-lg text-primary"></i> {{memberCount}} Members <a href="#"><span id="onInviteChannelModal" class="label label-info pull-right">ADD</span></a></h4>
         <ul class="members category-list nopadding">
          {{#members}}
          <li data-emplid="{{emplId}}">
            <span><img class="member-avatar" src="{{img}}" alt="{{imgAlt}}"> {{name}}</span>
          </li>
          {{/members}}
        </ul>
      </div>
      <div class="hr-line-dashed"></div>
      <div>
       <button type="button" class="leaveChannel btn btn-warning btn-sm btn-block"><i class="fa fa-sign-out"></i> Leave channel</button>
      </div>
    </script>
  </div>
</div>
<script>
$(document).ready(function() {
  var $informationSec = $("#information-section");
  var aboutChannelTemplate = $informationSec.find('#aboutChannel-template').html();
  var $title = $informationSec.find(".title");
  var $contentArea = $informationSec.find('.content_area');

  var channelId = activeChatInfo.channelId;
  var channelValue = channelCache.get(channelId);
  var existMembers;

  for(var key in channelValue.memberList) {
    var emplId = channelValue.memberList[key].emplId;
    if(!existMembers)
      existMembers = emplId;
    else
      existMembers += "," + channelValue.memberList[key].emplId;
  }
  var membersArray = String(existMembers).split(",");
  var memberCount = membersArray.length;

  $title.html("About " + channelValue.name);

  var aboutChannelData = {
    "pinupMessage": channelValue.pinupMessage,
    "memberCount": memberCount,
    "members":[]
  };

  for(var key in membersArray) {
    var userValue = userCache.get(membersArray[key]);
    var imagePath = getImagePath(userValue.photoLoc, userValue.teamId, userValue.emplId);
    aboutChannelData.members.push({
      "name" : userValue.name,
      "emplId" : userValue.emplId,
      "imgAlt" : userValue.name,
      "img": imagePath
    });
  }

  $contentArea.empty();
  $contentArea.prepend(Mustache.render(aboutChannelTemplate, aboutChannelData));

  var $linkEditPurpose = $(".link-edit-purpose");
  if(channelValue.pinupMessage) {
    $linkEditPurpose.text("Edit");
  }

  // apply event for editing purpose.
  $linkEditPurpose.click(function(){
    var $purposeEditArea = $("#purpose-edit-area");
    $purposeEditArea.show();
    $purposeEditArea.find("[name=purpose]").val($.trim($("#purpose").text()));

    $purposeEditArea.find(".done").click(function() {
      var purposeVal = $.trim($purposeEditArea.find("[name=purpose]").val());
      if(purposeVal === "") {
        toastr.warning("Please insert the purpose message.");
        return;
      }

      var params = {
        "channelId": channelValue.channelId,
        "name": channelValue.name,
        "pinupMessage": purposeVal
      };

      restResource.channel.updateChannel(params, function(response){
        reloadChannelCache(channelValue.channelId);
        $("#purpose").text(purposeVal);
        $purposeEditArea.hide();
        $linkEditPurpose.text("Edit");
      });
    });

    $purposeEditArea.find(".cancle").click(function() {
      $purposeEditArea.find("name[purpose]").val("");
      $purposeEditArea.hide();
    });
  });

  $("#onInviteChannelModal").bind("click", function() {
    openModalDialog("./information/invite_channel_popup.html");
  });

  $contentArea.find(".leaveChannel").click(function() {
    var params = {
      "channelId": channelId,
      "members": loginInfo.emplId,
    };

    restResource.channel.removeMember(params,
      function(response) {
        var channelValue = channelCache.get(channelId);
        if(channelValue) {
          var members;
          for(var key in channelValue.memberList) {
            var emplId = channelValue.memberList[key].emplId;

            var params = {
              "type": constants.CHANNEL_REMOVE_MEMBER,
              "channelId": channelId,
              "topic": activeChatInfo.topic,
              "member": loginInfo.emplId
            }

            chatModule.sendCommand(emplId, params);
          }
        }

        chatModule.sendMsg(activeChatInfo.topic, "left - " + loginInfo.name);
      }
    );
  });

  // set flag on online member of member list
  (function() {
    var params = {
      "teamId": loginInfo.teamId
    };

    restResource.login.getLoggedInEmplListByTeamId(params, function(data) {
      if(data) {
        $.each(data, function(idx, row) {
          var $activeTarget = $contentArea.find("[data-emplid='" + row.emplId + "']");
          var $profileImage = $activeTarget.find(".member-avatar");
          // online
          $profileImage.addClass("online");
        });
      }
    });
  }());

  displayChannelMember = function(members) {
    for(var key in members) {
      var userValue = userCache.get(members[key]);
      var imgUrl = getImagePath(userValue.photoLoc, userValue.teamId, userValue.emplId);
      $contentArea.find(".members").append("<li data-emplid='" + userValue.emplId + "'><a href='#'><img class='chat-avatar' src='" + imgUrl + "' alt='" + userValue.name + "'>" + userValue.name + "</a></li>");
    }
  }

  removeChannelMember = function(member) {
    $contentArea.find(".members [data-emplid='" + member + "']").remove();
  }

  // $informationSec.find(".ibox-content").mCustomScrollbar({
  //   axis:"y",
	// 	setWidth: "auto",
  //   theme:"3d"
  // });
});
</script>
