<div class="modal-dialog">
	<div class="middle-box text-center loginscreen animated fadeInDown">
		<div class="sk-spinner sk-spinner-rotating-plane" style="display:none"></div>
    <div>
      <h3>Welcome to TEAMON</h3>
      <p>Login in. To see it in action.</p>
      <form role="form" id="login-form">
          <div class="form-group">
              <input name="email" type="email" class="form-control" placeholder="Enter Email"/>
          </div>
          <div class="form-group">
              <input name="password" type="password" class="form-control" placeholder="Password"/>
          </div>
					<div class="form-group">
              <label><input id="keepMe" name="keepMe" type="checkbox" class="i-checks" /> Keep me signed in </label>
          </div>
          <button type="submit" class="btn btn-primary block full-width m-b">Login</button>
					<a class="btn btn-sm btn-white btn-block" id="onRegisterEmplModal">Create an account</a>
          <a href="#" id="forgot-password"><small>Forgot password?</small></a>
      </form>
    </div>
  </div>
</div>

<script>
$(document).ready(function() {
	$("#login-form").nameFind("email").focus();
	// set validation for login Form
	$("#login-form").validate({
		rules: {
			email: {
				required: true
			},
			password: {
				required: true
			}
		}
	});

	$("#login-form").delegate('#forgot-password', 'click touchend', function() {
		toastr.info("Ask to dev1.solution@uangel.com to reset password");
	});

	// add certificate install instruction if it's WEB
	if (runningChannel === 'WEB') {
		$('#login-form').append('<br/>')
			.append('<a href="https://192.168.1.84:8387/certification/" target="_blank"><small>How to install certificate</small></a>');
	}

	// set event for login action
	$('#login-form').submit(function(event) {
		event.preventDefault();

		var $loginAlert = $("#login-alert").addClass("hide");
		if (!$(this).valid())
			return;

		// show block screen
		showBlockScreen();

		// get user agent information
		var uaParser = new UAParser();
		uaParser.setUA(navigator.userAgent);
		var os = uaParser.getOS().name + (uaParser.getOS().name === "Windows" ? uaParser.getOS().version : "");
		var browser = uaParser.getBrowser().name + (uaParser.getBrowser().name === "IE" ? uaParser.getBrowser().major : "");
		var device = uaParser.getDevice().model == undefined ? runningChannel === 'APP' ? 'Desktop': '' : uaParser.getDevice().model;

		var params = $(this).serializeObject();
		params.team = "uangel";
		params.os = os;
		params.browser = browser;
		params.device = device;
		params.client = runningChannel;

		restResource.login.login(params, function(data, error) {
			if (data.errorCode || error) {
				// remove block screen
				removeBlockScreen();
				return;
			}
			configureCertifiedAPI(data.email, data.authKey);
			// set the personal pref info first to use it around the app.
			myPreference = new PreferenceManager(localStorageManager, data.emplId); // init preference
			myPreference.setPreference("emplId", data.emplId);
			myPreference.setPreference("email", data.email);
			myPreference.setPreference("authKey", data.authKey);

			loginInfo = {
	      "email": data.email,
				"emplId": data.emplId ? Number(data.emplId) : null,
				"authKey": data.authKey,
	      "teamId": data.teamId ? Number(data.teamId) : null,
				"name": data.name,
				"browser": browser,
				"os": os,
				"device": device,
				"photoLoc": data.photoLoc
	    };

			if (params.keepMe)
				localStorageManager.setValue("keepEmplId", data.emplId);
			else
				localStorageManager.removeKey("keepEmplId");
			sessionStorageManager.setValue("sessionEmplId", data.emplId);

			initialize(true);
			chatModule.configMyInfo(loginInfo.teamId, loginInfo.emplId);

			params = null;
		});

	});

	$('#onRegisterEmplModal').click(function() {
		openModalDialog("/user/register_empl_popup.html");
	});
});
</script>
