<div class="modal-dialog">
  <div class="modal-content animated bounceInRight">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
      <i class="fa fa-github-alt modal-icon"></i>
      <h4 class="modal-title">Create a new public channel</h4>
    </div>
    <div class="modal-body">
      <div class="row">
        <div>
          <form role="form" id="channelForm" onsubmit="return false;">
            <div class="form-group">
              <label>Channel name</label><input name="name" type="text" placeholder="Enter channel" class="form-control">
            </div>
            <div class="form-group">
              <label>Invite others to join</label>
              <div class="input-group col-sm-12">
                <select data-placeholder="Choose users..." class="chosen-select" name="members" multiple tabindex="4">
                  <option value="">Select</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label>Purpose(optional)</label>
              <input placeholder="Enter purpose" name="pinupMessage" class="form-control">
            </div>
          </form>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
      <button type="button" id="channel-join-submit" class="btn btn-primary" type="submit">Create channels</button>
    </div>
  </div>
</div>
<script>
$(document).ready(function() {
  var $channelForm = $("#channelForm");

  // set validation for login Form
  $channelForm.validate({
    rules: {
      name: {
        required: true,
        minlength: 3,
        specialcharacter: true
      },
      members: {
        required: true,
        min: 1
      }
    }
  });

  var userArray = userCache.getValueArray();
  var chosenSelect = $channelForm.find(".chosen-select");
  for(var key in userArray) {
    if (userArray[key].emplId === loginInfo.emplId) // select list에서 본인 제외
      continue;
    chosenSelect.append("<option value='" + userArray[key].emplId + "'>" + userArray[key].name + "</option>");
  }
  chosenSelect.chosen({width:"100%"});

  // set event for new create channel
  $("#channel-join-submit").bind("click", function() {
    if(!$channelForm.valid())
      return;

    var name = constants.CHANNEL_TOPIC_DELIMITER + $channelForm.find("[name=name]").val();
    var members = $channelForm.find("[name=members]").val();
    members.push(loginInfo.emplId +""); //본인 포함
    var pinupMessage = $channelForm.find("[name=pinupMessage]").val();

    var params = {
      "teamId": loginInfo.teamId,
      "name": name,
      "members": members,
      "pinupMessage": pinupMessage
    };

    restResourse.channel.createChannel(params,
      function(data, response) {
        // Success
        var params = {
          "type": constants.CHANNEL_CREATE,
          "teamId" : loginInfo.teamId,
          "topic" : name,
          "senderId" : loginInfo.emplId
        }

        for(var key in members) {
          chatModule.sendCommand(members[key], params);
        }

        $channelForm.closest(".modal-dialog").closest(".modal").modal("hide");
      }
    );
  });
});
</script>
