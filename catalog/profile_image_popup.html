
<div class="modal-dialog">
	<div class="modal-content animated fadeIn">
		<div class="modal-body">
      <form id="fileupload-form" class="dropzone" action="#">
        <div class="dropzone-previews"></div>
      </form>
      <div class="m text-right" style="height: 20px">
        <button id="submit-fileupload" type="submit" class="btn btn-primary pull-right">Upload profile image</button>
      </div>
    </div>
  </div>
</div>
<script>
var	dropzone = new Dropzone("#fileupload-form", {
    autoProcessQueue: false,
    uploadMultiple: false,
		acceptedFiles: "image/*",
		maxFiles: 1,
		url: UPLOAD_URL + loginInfo.teamId + "/profile_image/" + loginInfo.emplId + "/profile",
		dictDefaultMessage: "Drop file here to upload and click below upload button",

    // Dropzone settings
    init: function() {
        var profileDropzone = this;
        $("#submit-fileupload").click(function(e) {
            e.preventDefault();
            e.stopPropagation();
            profileDropzone.processQueue();
        });
				this.on("complete", function(file) {
					if (!file.accepted)
						this.removeFile(file);
				});
        this.on("sending", function() {
          $("#submit-fileupload").attr("disabled", "disabled");
        });
        this.on("success", function(file, response) {
					$("#submit-fileupload").closest(".modal-dialog").closest(".modal").modal("hide");
					var fileArr = file.name.split('.');
					var fileExt = fileArr[fileArr.length - 1];
					var fileUrl = getImagePath(loginInfo.emplId + '.' + fileExt, loginInfo.teamId, loginInfo.emplId);
					var params = $(this).serializeObject();
					params.emplId = loginInfo.emplId;
					params.photoLoc = loginInfo.emplId + '.' + fileExt;

					restResource.empl.changeProfileImg(params,
						function(data, response) {
							// Success
							myPreference.setPreference("photoLoc", params.photoLoc);
							loginInfo.photoLoc = params.photoLoc;
							// change profile image on the screen immediately
							// 1. profile section
							$("#myprofile-image").attr("src", fileUrl + "&_=" + new Date().getTime());
							// 2. about channel
							$("li[data-emplid=" + loginInfo.emplId + "] img").attr("src", fileUrl + "&_=" + new Date().getTime());
							// 3. chat message
							$(".chat-message.right img").attr("src", fileUrl + "&_=" + new Date().getTime());
							toastr.info("Your profile image has been modified successfully");
					});
        });
        this.on("error", function(file, response) {
					toastr.error(response + " [" + file.name + "]");
        });
    }
});
</script>
