<div class="modal-dialog">
	<div class="modal-content animated fadeIn">
		<div class="modal-body">
      <form id="fileupload-form" class="dropzone" action="#">
        <div class="dropzone-previews"></div>
      </form>
      <div class="m text-right" style="height: 20px">
        <button id="submit-fileupload" type="submit" class="btn btn-primary pull-right">Upload file(s)</button>
      </div>
    </div>
  </div>
</div>
<script>
var topicForURL = activeChatInfo.topic.startsWith("#") ? escape("#") + encodeURI(activeChatInfo.topic.substr(1)) : activeChatInfo.topic;

var dropzone = new Dropzone("#fileupload-form", {
    autoProcessQueue: false,
    uploadMultiple: true,
    parallelUploads: 10,
    maxFiles: 10,
		url: UPLOAD_URL + loginInfo.teamId + "/" + topicForURL + "/" + loginInfo.emplId + "/chat",
		dictDefaultMessage: "Drop files here to upload and click below upload button",

    // Dropzone settings
    init: function() {
        var fileDropzone = this;
        $("#submit-fileupload").click(function(e) {
            e.preventDefault();
            e.stopPropagation();
            fileDropzone.processQueue();
        });
        this.on("sendingmultiple", function() {
          $("#submit-fileupload").attr("disabled", "disabled");
        });
        this.on("successmultiple", function(files, response) {
					$("#submit-fileupload").closest(".modal-dialog").closest(".modal").modal("hide");
          var fileNames = "";
          $.each(files, function(idx) {
						var fileUrl = constants.REPOSITORY_URL + response[idx].name + "?teamId=" + loginInfo.teamId + "&topic=" + topicForURL + "&emplId=" + loginInfo.emplId + "&type=chat";
            fileNames += "<a href='" + fileUrl + "' target='_blank'>" + this.name + "</a>,";
          });
					chatModule.sendMsg(activeChatInfo.topic, "Files [" + fileNames.substr(0, fileNames.length-1) + "] uploaded");
					if ($(".file-list").length > 0)
						$("#info-file").click();
        });
        this.on("errormultiple", function(files, response) {
					$.each(files, function() {
						toastr.error(response + " [" + this.name + "]");
					});
        });
    }
});
</script>
